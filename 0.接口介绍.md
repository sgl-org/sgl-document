# SGL (Simple Graphics Library) 接口文档

## 1. 简介
![SGL_LOGO](imag/0/SGL_logo.png)
SGL (Simple Graphics Library) 是一个轻量级的嵌入式图形库，专为资源受限的设备设计。它提供了丰富的UI控件和高效的渲染机制，支持多种像素格式和硬件加速。

## 2. 核心API接口

### 2.1 初始化与主循环

#### sgl_init()

```c
void sgl_init(void);
```

SGL全局初始化函数。应在使用任何SGL功能之前调用此函数，并且应在注册帧缓冲设备之后调用。
#### sgl_tick_inc

```c
void sgl_tick_inc(uint8_t ms)
```

SGL动画系统的核心部分，用于追踪时间流逝**实时更新**：通常在系统1毫秒中断处理程序中调用，或者也可以通过轮询方式调用。

#### sgl_task_handle()

```c
void sgl_task_handle(void);
```
SGL任务处理函数。应定期在主循环、定时器或线程中调用，负责处理事件、动画和绘制任务。<font color="#c00000">禁止将 sgl_task_handle()与sgl_tick_inc()放一起。</font>

#### sgl_device_fb_register()

```c
int sgl_device_fb_register(sgl_device_fb_t *fb_dev);
```
注册帧缓冲设备。必须在调用sgl_init()之前调用此函数。

参数:
```c
- fb_dev: 帧缓冲设备结构体指针
```
#### 初始化运用

```C
    sgl_device_fb_t fb_dev;
    memset(&fb_dev, 0, sizeof(fb_dev));
    fb_dev.xres = CONFIG_SGL_PANEL_WIDTH;
    fb_dev.yres = CONFIG_SGL_PANEL_HEIGHT;
    fb_dev.xres_virtual = CONFIG_SGL_PANEL_WIDTH;
    fb_dev.yres_virtual = CONFIG_SGL_PANEL_HEIGHT;
    fb_dev.flush_area = panel_flush_area;
#if (CONFIG_SGL_DRAW_USE_DMA)
    fb_dev.buffer[0] = panel_buffer0;
    fb_dev.buffer[1] = panel_buffer1;
    fb_dev.buffer_size = SGL_ARRAY_SIZE(panel_buffer0);
#else
    fb_dev.buffer[0] = panel_buffer[0];
    fb_dev.buffer[1] = NULL;
    fb_dev.buffer_size = SGL_ARRAY_SIZE(panel_buffer);
#endif
    sgl_device_fb_register(&fb_dev);
    sgl_init();
    while (1) {
       sgl_task_handle();
    }
    
  static void anim_tick_thread(void *arg) {
	   while (1) 
		   { 
			   sgl_tick_inc(1);
			   vTaskDelay(pdMS_TO_TICKS(1)); 
		    } 
    }  
    
 static void panel_flush_area(int16_t x1, int16_t y1, int16_t x2, int16_t y2, sgl_color_t *src)

{

    if (src == NULL)
        return;
    // 使用驱动的图片绘制函数将像素数据发送到屏幕
    //st7789v_spi_draw_picture_blocking(x1, y1, x2, y2, (st7789v_spi_color_t *)src);
   //更换为你的驱动屏幕函数
}
```
### 2.2 对象管理

#### sgl_obj_create()


```C
sgl_obj_t* sgl_obj_create(sgl_obj_t *parent);
```
创建一个新的对象。

参数:
```C
- parent: 父对象指针
```
返回值:
- 新创建的对象指针
#### sgl_obj_delete()

```C
void sgl_obj_delete(sgl_obj_t *obj);
```
删除对象及其所有子对象。

参数:
```C
- obj: 要删除的对象指针
```
#### sgl_obj_set_pos()

```C
void sgl_obj_set_pos(sgl_obj_t *obj, int16_t x, int16_t y);
```
设置对象的位置。

参数:
```C
- obj: 对象指针
- x: X坐标
- y: Y坐标
```
#### sgl_obj_set_size()

```C
`void sgl_obj_set_size(sgl_obj_t *obj, int16_t width, int16_t height);`
```
设置对象的尺寸。

参数:
```C
- obj: 对象指针
- width: 宽度
- height: 高度
```

## 3. 控件接口

### 3.1 控件创建

```C
sgl_obj_t* sgl_xxxx_create(sgl_obj_t* parent);
```
创建对应控件。

相关设置函数:
```C
- sgl_xxxx_set_color(sgl_obj_t *obj, sgl_color_t color) - 设置颜色
- sgl_xxxx_set_alpha(sgl_obj_t *obj, uint8_t alpha) - 设置透明度
- sgl_xxxx_set_radius(sgl_obj_t *obj, uint16_t radius) - 设置圆角半径
- sgl_xxxx_set_border_width(sgl_obj_t *obj, uint8_t width) - 设置边框宽度
- sgl_xxxx_set_border_color(sgl_obj_t *obj, sgl_color_t color) - 设置边框颜色
- sgl_xxxx_set_text(sgl_obj_t *obj, const char *text) - 设置文本
- sgl_xxxx_set_font(sgl_obj_t *obj, const sgl_font_t *font) - 设置字体
- sgl_xxxx_set_text_color(sgl_obj_t *obj, sgl_color_t color) - 设置文本颜色
- sgl_xxxx_set_pixmap(sgl_obj_t *obj, const sgl_pixmap_t *pixmap) - 设置背景图
- sgl_xxxx_set_bg_color(sgl_obj_t *obj, sgl_color_t color) - 设置背景颜色  
```
> ⚠️  xxxx为控件名，为了方便介绍这里写的比较笼统，里面有部分接口没有写上来，如设置文本偏移只有标签控件才有；上面列的东西大多数控件都有但也有少部分只支持部分接口。因此，你可以查看相应控件的文档本部分仅为介绍。

### 3.2 高级控件

#### 进度条控件 (Progress Bar)

```c
sgl_obj_t* sgl_progress_create(sgl_obj_t* parent);
```
创建进度条控件。

相关设置函数:
```C
- sgl_progress_set_color(sgl_obj_t *obj, sgl_color_t color) - 设置进度条颜色
- sgl_progress_set_track_color(sgl_obj_t *obj, sgl_color_t color) - 设置轨道颜色
- sgl_progress_set_value(sgl_obj_t *obj, uint8_t value) - 设置进度值
```
#### 滑动条控件 (Slider)

```c
sgl_obj_t* sgl_slider_create(sgl_obj_t* parent);
```
创建滑动条控件。

#### 开关控件 (Switch)

```C
sgl_obj_t* sgl_switch_create(sgl_obj_t* parent);
```
创建开关控件。

#### SGL待支持控件......（如波形图、菜单）
## 4. 事件处理

### 4.1 事件发送

```C
void sgl_event_send_pos(sgl_event_pos_t pos, sgl_event_type_t type); 
void sgl_event_send_obj(struct sgl_obj *obj, sgl_event_type_t type);
```
### 4.2 事件类型
```
- SGL_EVENT_PRESSED - 按下事件
- SGL_EVENT_RELEASED - 释放事件
- SGL_EVENT_MOTION - 移动事件
```
## 5. 动画系统

### 5.1 动画创建与管理

```c
`sgl_anim_t* sgl_anim_create(void); void sgl_anim_init(sgl_anim_t *anim);`
```
### 5.2 动画设置

```C
void sgl_anim_set_data(sgl_anim_t *anim, void *data); 
void sgl_anim_set_act_duration(sgl_anim_t *anim, uint32_t duration); 
void sgl_anim_set_start_value(sgl_anim_t *anim, int32_t start);
void sgl_anim_set_end_value(sgl_anim_t *anim, int32_t end); 
void sgl_anim_set_path(sgl_anim_t *anim, sgl_anim_path_cb_t path_cb, sgl_anim_path_type_t type); 
void sgl_anim_start(sgl_anim_t *anim);
```
